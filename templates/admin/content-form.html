{% extends "page--admin.html" %}
{% import "admin/macros/tabs.html" as tabs %}

{% set has_compound = false %}
{% for field in content_type.fields %}
{% if field.field_type.Compound %}{% set_global has_compound = true %}{% endif %}
{% endfor %}

{% block head %}
{{ super() }}
{% if has_compound %}
<link rel="stylesheet" href="/static/css/compound-field.css">
{% endif %}
{% endblock %}

{% block content %}
<div class="admin-header">
    <h2>{% if editing %}Edit {{ content_type.label }}{% else %}Create {{ content_type.label }}{% endif %}</h2>
</div>

{% if local_tasks is defined %}{{ tabs::tab_bar(local_tasks=local_tasks) }}{% endif %}

<div class="admin-card">
    <form id="content-form" method="post" action="{{ action }}">
        <input type="hidden" name="_token" value="{{ csrf_token }}">
        <input type="hidden" name="_form_build_id" value="{{ form_build_id }}">

        {% if errors %}
        <div class="form__errors">
            <ul>
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="form-item">
            <label for="title" class="form-item__label form-item__label--required">Title</label>
            <input type="text" id="title" name="title" class="form-text"
                   value="{{ values.title | default(value='') }}"
                   required>
        </div>

        {% for field in content_type.fields %}
        <div class="form-item">
            <label for="{{ field.field_name }}" class="form-item__label {% if field.required %}form-item__label--required{% endif %}">
                {{ field.label }}
            </label>
            {% if field.field_type == "text" or field.field_type.Text %}
            <input type="text" id="{{ field.field_name }}" name="{{ field.field_name }}" class="form-text"
                   value="{% if values.fields %}{{ values.fields[field.field_name] | default(value='') }}{% elif item %}{{ item.fields[field.field_name] | default(value='') }}{% endif %}"
                   {% if field.required %}required{% endif %}>
            {% elif field.field_type == "textarea" or field.field_type == "text_long" or field.field_type.TextLong %}
            <textarea id="{{ field.field_name }}" name="{{ field.field_name }}" class="form-textarea" rows="5"
                      {% if field.required %}required{% endif %}>{% if values.fields %}{{ values.fields[field.field_name] | default(value='') }}{% elif item %}{{ item.fields[field.field_name] | default(value='') }}{% endif %}</textarea>
            {% elif field.field_type == "boolean" or field.field_type.Boolean %}
            <div class="form-checkbox-wrapper">
                <input type="checkbox" id="{{ field.field_name }}" name="{{ field.field_name }}" value="1"
                       {% if values.fields[field.field_name] or (item and item.fields[field.field_name]) %}checked{% endif %}>
            </div>
            {% elif field.field_type == "integer" or field.field_type == "number" or field.field_type.Integer %}
            <input type="number" id="{{ field.field_name }}" name="{{ field.field_name }}" class="form-text"
                   value="{% if values.fields %}{{ values.fields[field.field_name] | default(value='') }}{% elif item %}{{ item.fields[field.field_name] | default(value='') }}{% endif %}"
                   {% if field.required %}required{% endif %}>
            {% elif field.field_type.Compound %}
            <div class="compound-field" id="compound-{{ field.field_name }}"
                 data-field="{{ field.field_name }}"
                 data-config="{{ field.field_type.Compound | json_encode() | escape }}"
                 data-section-types="{{ field.settings.section_types | default(value=[]) | json_encode() | escape }}">
                <div class="compound-field__sections">
                </div>
                <input type="hidden" name="{{ field.field_name }}" class="compound-field__value"
                       value="{% if values.fields[field.field_name] %}{{ values.fields[field.field_name] | json_encode() | escape }}{% elif item and item.fields[field.field_name] %}{{ item.fields[field.field_name] | json_encode() | escape }}{% else %}{&quot;sections&quot;:[]}{% endif %}">
                <div class="compound-field__actions">
                    <button type="button" class="button compound-field__add">Add section</button>
                </div>
            </div>
            {% else %}
            <input type="text" id="{{ field.field_name }}" name="{{ field.field_name }}" class="form-text"
                   value="{% if values.fields %}{{ values.fields[field.field_name] | default(value='') }}{% elif item %}{{ item.fields[field.field_name] | default(value='') }}{% endif %}"
                   {% if field.required %}required{% endif %}>
            {% endif %}
            {% if field.description %}
            <p class="form-item__description">{{ field.description }}</p>
            {% endif %}
        </div>
        {% endfor %}

        <fieldset class="fieldset">
            <legend>Publishing options</legend>
            <div class="fieldset__content">
                <div class="form-item form-item--checkbox">
                    <div class="form-checkbox-wrapper">
                        <input type="checkbox" id="status" name="status" value="1"
                               {% if values.status %}checked{% elif not editing %}checked{% endif %}>
                        <label for="status">Published</label>
                    </div>
                </div>
            </div>
        </fieldset>

        <div class="form-actions">
            <button type="submit" class="button button--primary">{% if editing %}Save changes{% else %}Create content{% endif %}</button>
            <a href="/admin/content" class="button button--secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{% if has_compound %}
<script src="/static/js/compound-field.js"></script>
{% endif %}
{% endblock %}
