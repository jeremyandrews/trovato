{% extends "page--admin.html" %}
{% import "admin/macros/list.html" as list %}

{% block content %}
{{ list::header(title="Files") }}

<div class="admin-card">
    <form class="filter-form" method="get" action="/admin/content/files">
        <div class="filter-row">
            <div class="filter-item">
                <label for="status">Status</label>
                <select id="status" name="status">
                    <option value="">- Any -</option>
                    <option value="0" {% if status_filter == 0 %}selected{% endif %}>Temporary</option>
                    <option value="1" {% if status_filter == 1 %}selected{% endif %}>Permanent</option>
                </select>
            </div>
            <div class="filter-item">
                <button type="submit" class="button button--secondary">Filter</button>
            </div>
        </div>
    </form>
</div>

<div class="admin-card">
    {% if files %}
    <table class="table">
        <thead>
            <tr>
                <th>Filename</th>
                <th>Type</th>
                <th>Size</th>
                <th>Owner</th>
                <th>Status</th>
                <th>Uploaded</th>
                <th>Operations</th>
            </tr>
        </thead>
        <tbody>
            {% for file in files %}
            <tr>
                <td>
                    <a href="/admin/content/files/{{ file.id }}">{{ file.filename }}</a>
                </td>
                <td>{{ file.filemime }}</td>
                <td>{{ (file.filesize / 1024) | round(precision=1) }} KB</td>
                <td>{{ owners[file.owner_id] | default(value="Unknown") }}</td>
                <td>
                    {% if file.status == "Permanent" %}
                    <span class="status status--permanent">Permanent</span>
                    {% else %}
                    <span class="status status--temporary">Temporary</span>
                    {% endif %}
                </td>
                <td>{{ file.created | date(format="%Y-%m-%d %H:%M") }}</td>
                <td>
                    <a href="/admin/content/files/{{ file.id }}">View</a>
                    &middot;
                    {{ list::delete_button(action="/admin/content/files/" ~ file.id ~ "/delete", confirm_text="Are you sure you want to delete this file?", csrf_token=csrf_token) }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No files found.</p>
    {% endif %}
</div>

<style>
    .filter-form {
        margin-bottom: 0;
    }
    .filter-row {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
    }
    .filter-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    .filter-item label {
        font-size: 0.875rem;
        font-weight: 500;
    }
    .filter-item select {
        padding: 0.375rem 0.5rem;
        border: 1px solid #ccc;
        border-radius: 0.25rem;
    }
    .status {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
    }
    .status--permanent {
        background: #d4edda;
        color: #155724;
    }
    .status--temporary {
        background: #fff3cd;
        color: #856404;
    }
</style>
{% endblock %}
