{% extends "page--admin.html" %}

{% block content %}
<div class="admin-header">
    <h2>{% if editing %}Edit category{% else %}Add category{% endif %}</h2>
</div>

<div class="admin-card">
    <form id="category-form" method="post" action="{{ action }}">
        <input type="hidden" name="_token" value="{{ csrf_token }}">
        <input type="hidden" name="_form_build_id" value="{{ form_build_id }}">

        {% if errors %}
        <div class="form__errors">
            <ul>
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="form-item">
            <label for="label" class="form-item__label form-item__label--required">Name</label>
            <input type="text" id="label" name="label" class="form-text"
                   value="{{ values.label | default(value='') }}"
                   required
                   data-machine-name-source="#id">
            <p class="form-item__description">The human-readable name of this category.</p>
        </div>

        <div class="form-item">
            <label for="id" class="form-item__label form-item__label--required">Machine name</label>
            <input type="text" id="id" name="id" class="form-text"
                   value="{{ values.id | default(value='') }}"
                   pattern="[a-z][a-z0-9_]*"
                   required
                   {% if editing %}readonly{% endif %}>
            <p class="form-item__description">A unique machine-readable name. Can only contain lowercase letters, numbers, and underscores.</p>
        </div>

        <div class="form-item">
            <label for="description" class="form-item__label">Description</label>
            <textarea id="description" name="description" class="form-textarea" rows="3">{{ values.description | default(value='') }}</textarea>
        </div>

        <div class="form-item">
            <label for="hierarchy" class="form-item__label">Hierarchy type</label>
            <select id="hierarchy" name="hierarchy" class="form-select">
                <option value="0" {% if values.hierarchy == 0 %}selected{% endif %}>Flat (no hierarchy)</option>
                <option value="1" {% if values.hierarchy == 1 %}selected{% endif %}>Single parent</option>
                <option value="2" {% if values.hierarchy == 2 %}selected{% endif %}>Multiple parents</option>
            </select>
            <p class="form-item__description">Whether tags can have parent tags.</p>
        </div>

        <div class="form-actions">
            <button type="submit" class="button button--primary">{% if editing %}Save changes{% else %}Create category{% endif %}</button>
            <a href="/admin/structure/categories" class="button button--secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
// Auto-generate machine name from label
document.getElementById('label').addEventListener('input', function(e) {
    const machineNameInput = document.getElementById('id');
    if (!machineNameInput.readOnly && !machineNameInput.dataset.userEdited) {
        machineNameInput.value = e.target.value
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, '_')
            .replace(/^_+|_+$/g, '')
            .substring(0, 32);
    }
});

document.getElementById('id').addEventListener('input', function() {
    this.dataset.userEdited = 'true';
});
</script>
{% endblock %}
